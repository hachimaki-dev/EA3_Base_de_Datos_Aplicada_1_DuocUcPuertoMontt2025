DROP TABLE MARCAS CASCADE CONSTRAINT;
DROP TABLE FAMILIA CASCADE CONSTRAINT;
DROP TABLE ALMACEN CASCADE CONSTRAINT;
DROP TABLE CLIENTES CASCADE CONSTRAINT;
DROP TABLE PAIS CASCADE CONSTRAINT;
DROP TABLE ESTADO_ENVIO CASCADE CONSTRAINT;
DROP TABLE METODO_PAGO CASCADE CONSTRAINT;
DROP TABLE PROVEEDOR_ENVIO CASCADE CONSTRAINT;
DROP TABLE PRODUCTOS CASCADE CONSTRAINT;
DROP TABLE STOCK_ALMACEN CASCADE CONSTRAINT;
DROP TABLE REGIONES CASCADE CONSTRAINT;
DROP TABLE CIUDADES CASCADE CONSTRAINT;
DROP TABLE COMUNAS CASCADE CONSTRAINT;
DROP TABLE DIRECCIONES CASCADE CONSTRAINT;
DROP TABLE PAGO CASCADE CONSTRAINT;
DROP TABLE ENVIOS CASCADE CONSTRAINT;
DROP TABLE PEDIDOS CASCADE CONSTRAINT;
DROP TABLE PRODUCTO_FAMILIA CASCADE CONSTRAINT;
DROP TABLE PRODUCTO_FAMILIA CASCADE CONSTRAINT;


-- Esto es un comentario

CREATE TABLE MARCAS(
    id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY, 
    nombre VARCHAR2(50) NOT NULL
);

CREATE TABLE FAMILIA(
    id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    NOMBRE VARCHAR2(50) NOT NULL
);



CREATE TABLE ALMACEN(
    id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    nombre VARCHAR2(50) NOT NULL
);

CREATE TABLE CLIENTES(
    id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    nombre VARCHAR2(100) NOT NULL
);


CREATE TABLE PAIS(
    id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    nombre VARCHAR2(50) NOT NULL
);

CREATE TABLE ESTADO_ENVIO(
    id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    nombre VARCHAR2(50) NOT NULL
);

CREATE TABLE METODO_PAGO(
    id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    nombre VARCHAR2(50) NOT NULL
);


CREATE TABLE PROVEEDOR_ENVIO(
    id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    nombre VARCHAR2(50) NOT NULL,
    telefono VARCHAR2(20) NOT NULL
);

-- CREAR TABLAS CON DEPENDECIAS 1 N
-- REGIONES; CIUDAES; COMUNAS; DIRECCIONES; PAGO; ENVIO; PEDIDOS

CREATE TABLE PRODUCTOS(
    id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    nombre VARCHAR2(100) NOT NULL,
    id_marca NUMBER REFERENCES MARCAS(id) NOT NULL
);

CREATE TABLE STOCK_ALMACEN(
    id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    stock NUMBER(7) NOT NULL,
    fecha_rebasstecimiento TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL,
    stock_minimo NUMBER(3) NOT NULL,
    id_almacen NUMBER REFERENCES ALMACEN(id) NOT NULL,
    id_producto NUMBER REFERENCES PRODUCTOS(id) NOT NULL
);


CREATE TABLE REGIONES(
    id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    nombre VARCHAR2(50) NOT NULL UNIQUE,
    id_pais NUMBER REFERENCES PAIS(id) NOT NULL
);

CREATE TABLE CIUDADES(
    id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    nombre VARCHAR2(50) NOT NULL UNIQUE,
    id_region NUMBER REFERENCES REGIONES(id) NOT NULL
);

CREATE TABLE COMUNAS(
    id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    nombre VARCHAR2(50) NOT NULL UNIQUE,
    id_ciudad NUMBER REFERENCES CIUDADES(id) NOT NULL
);

CREATE TABLE DIRECIONES(
    id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    calle VARCHAR2(200) NOT NULL,
    numero NUMBER(5) NOT NULL,
    id_comuna NUMBER REFERENCES COMUNAS(id) NOT NULL
);

CREATE TABLE PAGO(
    id NUMBER GENERATED ALWAYS AS IDENTIDY PRIMARY KEY,
    fecha_pago TIMESTAMP DEFAULT SYSTIMESTAMP,
    id_metodo_pago NUMBER REFERENCES METODO_PAGO(id) NOT NULL  
);

CREATE TABLE ENVIOS(
    id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    fecha_despacho DATE NOT NULL, 
    fecha_entrega TIMESTAMP DEFAULT SYSTIMESTAMP, 
    id_estado_envio NUMBER REFERENCES ESTADO_ENVIO(id) NOT NULL,
    id_proveedor_envio NUMBER REFERENCES PROVEEDOR_ENVIO(id) NOT NULL
);

CREATE TABLE PEDIDOS(
    id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    fecha_pedido TIMESTAMP DEFAULT SYSTIMESTAMP,
    id_cliente NUMBER REFERENCES CLIENTES(id) NOT NULL,
    id_envio NUMBER REFERENCES ENVIOS(id) NOT NULL,
    id_pago NUMBER REFERENCES PAGO(id) NOT NULL
);

-- Tablas pivote
CREATE TABLE PRODUCTO_FAMILIA(
    --id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    id_producto NUMBER REFERENCES PRODUCTOS(id) NOT NULL,
    id_familia NUMBER REFERENCES FAMILIA(id) NOT NULL
);


-- Tablas sin dependencias

-- MARCAS
INSERT INTO MARCAS (nombre) VALUES ('Samsung');
INSERT INTO MARCAS (nombre) VALUES ('Apple');
INSERT INTO MARCAS (nombre) VALUES ('Sony');
INSERT INTO MARCAS (nombre) VALUES ('LG');
INSERT INTO MARCAS (nombre) VALUES ('Huawei');

-- FAMILIA
INSERT INTO FAMILIA (nombre) VALUES ('Electrónica');
INSERT INTO FAMILIA (nombre) VALUES ('Electrodomésticos');
INSERT INTO FAMILIA (nombre) VALUES ('Computación');
INSERT INTO FAMILIA (nombre) VALUES ('Telefonía');
INSERT INTO FAMILIA (nombre) VALUES ('Videojuegos');

-- ALMACEN
INSERT INTO ALMACEN (nombre) VALUES ('Central Santiago');
INSERT INTO ALMACEN (nombre) VALUES ('Bodega Norte');
INSERT INTO ALMACEN (nombre) VALUES ('Sucursal Viña del Mar');
INSERT INTO ALMACEN (nombre) VALUES ('Sucursal Concepción');
INSERT INTO ALMACEN (nombre) VALUES ('Depósito Temuco');

-- CLIENTES
INSERT INTO CLIENTES (nombre) VALUES ('Juan Pérez');
INSERT INTO CLIENTES (nombre) VALUES ('María González');
INSERT INTO CLIENTES (nombre) VALUES ('Carlos Rivas');
INSERT INTO CLIENTES (nombre) VALUES ('Ana Soto');
INSERT INTO CLIENTES (nombre) VALUES ('Pedro Morales');

-- PAIS
INSERT INTO PAIS (nombre) VALUES ('Chile');
INSERT INTO PAIS (nombre) VALUES ('Argentina');
INSERT INTO PAIS (nombre) VALUES ('Perú');
INSERT INTO PAIS (nombre) VALUES ('Brasil');
INSERT INTO PAIS (nombre) VALUES ('México');

-- ESTADO_ENVIO
INSERT INTO ESTADO_ENVIO (nombre) VALUES ('Pendiente');
INSERT INTO ESTADO_ENVIO (nombre) VALUES ('En tránsito');
INSERT INTO ESTADO_ENVIO (nombre) VALUES ('Entregado');
INSERT INTO ESTADO_ENVIO (nombre) VALUES ('Devuelto');
INSERT INTO ESTADO_ENVIO (nombre) VALUES ('Cancelado');

-- METODO_PAGO
INSERT INTO METODO_PAGO (nombre) VALUES ('Tarjeta de crédito');
INSERT INTO METODO_PAGO (nombre) VALUES ('Transferencia bancaria');
INSERT INTO METODO_PAGO (nombre) VALUES ('Efectivo');
INSERT INTO METODO_PAGO (nombre) VALUES ('PayPal');
INSERT INTO METODO_PAGO (nombre) VALUES ('Criptomoneda');

-- PROVEEDOR_ENVIO
INSERT INTO PROVEEDOR_ENVIO (nombre, telefono) VALUES ('Correos de Chile', '+56 2 600 950 2020');
INSERT INTO PROVEEDOR_ENVIO (nombre, telefono) VALUES ('Chilexpress', '+56 2 600 200 0102');
INSERT INTO PROVEEDOR_ENVIO (nombre, telefono) VALUES ('Starken', '+56 2 600 200 0111');
INSERT INTO PROVEEDOR_ENVIO (nombre, telefono) VALUES ('Bluexpress', '+56 2 2345 6789');
INSERT INTO PROVEEDOR_ENVIO (nombre, telefono) VALUES ('DHL', '+56 2 2599 8888');


-- Inderts de las tablas con dependecia
-- PRODUCTOS (depende de MARCAS)
INSERT INTO PRODUCTOS (nombre, id_marca) VALUES ('Smartphone Galaxy S23', 1);
INSERT INTO PRODUCTOS (nombre, id_marca) VALUES ('iPhone 15', 2);
INSERT INTO PRODUCTOS (nombre, id_marca) VALUES ('Televisor Bravia 55"', 3);
INSERT INTO PRODUCTOS (nombre, id_marca) VALUES ('Refrigerador InstaView', 4);
INSERT INTO PRODUCTOS (nombre, id_marca) VALUES ('Tablet MatePad Pro', 5);

-- STOCK_ALMACEN (depende de ALMACEN y PRODUCTOS)
INSERT INTO STOCK_ALMACEN (stock, stock_minimo, id_almacen, id_producto)
VALUES (120, 10, 1, 1);

INSERT INTO STOCK_ALMACEN (stock, stock_minimo, id_almacen, id_producto)
VALUES (85, 5, 2, 2);

INSERT INTO STOCK_ALMACEN (stock, stock_minimo, id_almacen, id_producto)
VALUES (45, 3, 3, 3);

INSERT INTO STOCK_ALMACEN (stock, stock_minimo, id_almacen, id_producto)
VALUES (60, 4, 4, 4);

INSERT INTO STOCK_ALMACEN (stock, stock_minimo, id_almacen, id_producto)
VALUES (30, 2, 5, 5);

COMMIT;



--Diferencia entre esto
SELECT * FROM STOCK_ALMACEN;


--Y esto
SELECT 
    sa.id AS id_stock,
    a.nombre AS nombre_almacen,
    p.nombre AS nombre_producto,
    sa.stock,
    sa.stock_minimo,
    sa.fecha_rebasstecimiento
FROM STOCK_ALMACEN sa
JOIN ALMACEN a 
    ON sa.id_almacen = a.id
JOIN PRODUCTOS p 
    ON sa.id_producto = p.id;
